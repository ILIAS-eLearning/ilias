/**
 * This file is part of ILIAS, a powerful learning management system
 * published by ILIAS open source e-Learning e.V.
 *
 * ILIAS is licensed with the GPL-3.0,
 * see https://www.gnu.org/licenses/gpl-3.0.en.html
 * You should have received a copy of said license along with the
 * source code, too.
 *
 * If this is not the case or you just want to try ILIAS, you'll find
 * us at:
 * https://www.ilias.de
 * https://github.com/ILIAS-eLearning
 */
!function(){"use strict";var t=function(t,n){var i="il-item-notification-replacement-container";return{getNotificationItemObject:function(o){console.assert(o instanceof jQuery,"$item_or_object_inside_item is not a jQuery Object, param: "+o);var s=o;return s.hasClass(i)||(s=o.closest("."+i)),console.assert(s.length>0,"Passed jQuery Object does not contain a Notification Item"),e.bind({})(s,t,n)}}},e=function(e,n,i){this.replaceByAsyncItem=function(t,n){return l(f()),f().remove(),r(t,n,(function(t){g().show(),e.html(t)})),this},this.replaceContentByAsyncItemContent=function(t,i){return r(t,i,(function(t){c(e,n(t),[".il-item-notification-title",".il-item-additional-content",".il-item-properties",".il-item-description"])})),this},this.addAsyncAggregate=function(t,e){var n=this;return r(t,e,(function(t){1===f().append(t).find(".il-item-notification-replacement-container").length&&n.registerAggregates()})),this},this.getCounterObjectIfAny=function(){if(y().length)return i(n).getCounterObject(b())},this.registerAggregates=function(t){var n=f().hide();if(n.find(".il-maincontrols-slate-notification-title").click((function(){l(n)})),!t){var i=e.find(".il-item-notification-title").first();i.find("a").attr("href","#"),i.click((function(t){a(n)}))}return this},this.registerCloseAction=function(t,n){var i=this,o=this.getCloseButtonOfItem();return o.length&&"#"!==t&&o.click((function(){if(!i.isAggregate()||!i.hasSibblings()){var o=i.getCounterObjectIfAny();o&&o.decrementNoveltyCount(n)}r(t,{},(function(t){e.append(t)})),h(i)})),this},this.closeItem=function(t=0){let e=this.getCounterObjectIfAny();return e&&t>0&&e.decrementNoveltyCount(t),h(this),this},this.closeNotificationCenter=function(){y().length&&b().filter(".engaged").trigger("click")},this.setItemDescription=function(t){var n=e.find(".il-item-description");if(0==n.length)throw"No Description Field in DOM for given Notification Item";return n.text(t),this},this.getItemDescription=function(){return e.find(".il-item-description").text()},this.removeItemProperties=function(){return e.find(".il-item-divider").remove(),e.find(".il-item-properties").remove(),this},this.setItemPropertyValueAtPosition=function(t,e){return s(e).text(t),this},this.getItemPropertyValueAtPosition=function(t){return s(t).text()},this.getCloseButtonOfItem=function(){return e.find(".close").first()},this.hasSibblings=function(){return this.getNrOfSibblings()>0},this.getNrOfSibblings=function(){return e.siblings().children(".il-notification-item").length},this.getParentItem=function(){return!!this.isAggregate()&&t(n,i).getNotificationItemObject(e.parents(".il-item-notification-replacement-container"))},this.isAggregate=function(){return e.parents(".il-aggregate-notifications").length>0};var o={closeNotificationCenter:this.closeNotificationCenter,setItemDescription:this.setItemDescription,getItemDescription:this.getItemDescription,removeItemProperties:this.removeItemProperties,setItemPropertyValueAtPosition:this.setItemPropertyValueAtPosition,getItemPropertyValueAtPosition:this.getItemPropertyValueAtPosition,closeItem:this.closeItem,registerCloseAction:this.registerCloseAction,registerAggregates:this.registerAggregates,replaceByAsyncItem:this.replaceByAsyncItem,replaceContentByAsyncItemContent:this.replaceContentByAsyncItemContent,addAsyncAggregate:this.addAsyncAggregate,getCloseButtonOfItem:this.getCloseButtonOfItem,getCounterObjectIfAny:this.getCounterObjectIfAny,hasSibblings:this.hasSibblings,getNrOfSibblings:this.getNrOfSibblings,getParentItem:this.getParentItem,isAggregate:this.isAggregate},s=function(t){let n=e.find(".il-item-properties .il-item-property-value");if(0==n.length)throw"No properties exist for in DOM for given Notification Item";if(n.length<t)throw"No property with position "+t+" doest not exist for given Notification Item";return n.eq(t-1)},r=function(t,e,i){n.ajax({url:t,data:e,type:"GET"}).done((function(t){i(t)}))},c=function(t,e,n){n.forEach((function(n){t.find(n).first().html(e.find(n).html())}))},a=function(t){var n=g();n.length?(n.siblings().hide(),n.hide(),t.insertAfter(n).show()):(t.insertAfter(e).show(),e.hide()),u(t.get(0))};const u=function(t){const e=Array.from(t.querySelectorAll("input:not([disabled])")).concat(Array.from(t.querySelectorAll("select:not([disabled])"))).concat(Array.from(t.querySelectorAll("textarea:not([disabled])"))).concat(Array.from(t.querySelectorAll("button:not([disabled])"))).concat(Array.from(t.querySelectorAll("[href]"))).concat(Array.from(t.querySelectorAll('[tabindex]:not([tabindex^="-"])')));e.length>0&&e.at(0).focus()};var l=function(t){var n=g();n.length&&(n.siblings().show(),n.show(),u(n.get(0))),e.show().append(t),t.hide()},h=function(t){t.hasSibblings()||(g().hide(),t.isAggregate()&&g().show().siblings().show()),e.children().remove()},f=function(){var t=g().parent();return t.length||(t=n("body")),t.find(".il-aggregate-notifications[data-aggregatedby="+m()+"]")},g=function(){return e.parents(".il-maincontrols-slate-notification")},m=function(){return e.find(".il-notification-item").first().attr("id")},y=function(){return e.parents(".il-maincontrols-metabar")},b=function(){var t=y();if(t.length)return t.find("li > .btn-bulky .glyphicon-bell").parents(".btn-bulky")};return o},n=function(t){var e="il-counter",n={getCounterObject:function(t){let e;return e=o(t),console.assert(e.length>0,"Passed jQuery Object does not contain a counter"),s(e)},getCounterObjectOrNull:function(t){let e;return e=o(t),0===e.length?null:s(e)}},o=function(n){console.assert(n instanceof t,"$object_containing_counter is not a jQuery Object, param: "+n);var i=n;return n.hasClass(e)||(i=n.find("."+e)),i},s=function(e){return i.bind({})(e,t)};return n},i=function(t,e){const i=" Counter does not exist in the DOM. Make sure the respective Counter type has been rendered before applying this operations.",o=" is not a number";this.getStatusCount=function(){return a(c(t))},this.getNoveltyCount=function(){return a(r(t))},this.hasNoveltyObject=function(){return r(t).length>0},this.hasStatusObject=function(){return c(t).length>0},this.setNoveltyTo=function(e){console.assert(this.hasNoveltyObject(),"Novelty "+i),console.assert("number"==typeof e,e+o);var n=r(t);return n.html(e),0===e?n.hide():n.show(),this},this.setStatusTo=function(e){console.assert(this.hasStatusObject(),"Status "+i),console.assert("number"==typeof e,e+o);var n=c(t);return n.html(e),0===e?n.hide():n.show(),this},this.incrementNoveltyCount=function(e){return console.assert(this.hasNoveltyObject(),"Novelty "+i),console.assert("number"==typeof e,e+o),u((function(t){t.hasNoveltyObject()&&t.setNoveltyTo(t.getNoveltyCount()+e)}),t),this},this.decrementNoveltyCount=function(e){return console.assert(this.hasNoveltyObject(),"Novelty "+i),console.assert("number"==typeof e,e+o),u((function(t){t.hasNoveltyObject()&&t.setNoveltyTo(t.getNoveltyCount()-e)}),t),this},this.incrementStatusCount=function(e){return console.assert(this.hasStatusObject(),"Status "+i),console.assert("number"==typeof e,e+o),u((function(t){t.hasStatusObject()&&t.setStatusTo(t.getStatusCount()+e)}),t),this},this.decrementStatusCount=function(e){return console.assert(this.hasStatusObject(),"Status "+i),console.assert("number"==typeof e,e+o),u((function(t){t.hasStatusObject()&&t.setStatusTo(t.getStatusCount()-e)}),t),this},this.setTotalNoveltyToStatusCount=function(){return console.assert(this.hasStatusObject(),"Status "+i),console.assert(this.hasNoveltyObject(),"Novelty "+i),this.incrementStatusCount(this.getNoveltyCount()).setNoveltyTo(0)};var s={getNoveltyCount:this.getNoveltyCount,getStatusCount:this.getStatusCount,hasNoveltyObject:this.hasNoveltyObject,hasStatusObject:this.hasStatusObject,setNoveltyTo:this.setNoveltyTo,setStatusTo:this.setStatusTo,incrementNoveltyCount:this.incrementNoveltyCount,decrementNoveltyCount:this.decrementNoveltyCount,incrementStatusCount:this.incrementStatusCount,decrementStatusCount:this.decrementStatusCount,setTotalNoveltyToStatusCount:this.setTotalNoveltyToStatusCount},r=function(t){return t.find(".il-counter-novelty")},c=function(t){return t.find(".il-counter-status")},a=function(t){var n=0;return t.each((function(){var t=e(this).text();n+=parseInt(t)})),n},u=function(t,i){i.each((function(){var i=n(e).getCounterObject(e(this));t(i,e(this))}))};return s};il.UI=il.UI||{},il.UI.item=il.UI.item||{},il.UI.item.notification=t($,n)}();
