/**
 * This file is part of ILIAS, a powerful learning management system
 * published by ILIAS open source e-Learning e.V.
 *
 * ILIAS is licensed with the GPL-3.0,
 * see https://www.gnu.org/licenses/gpl-3.0.en.html
 * You should have received a copy of said license along with the
 * source code, too.
 *
 * If this is not the case or you just want to try ILIAS, you'll find
 * us at:
 * https://www.ilias.de
 * https://github.com/ILIAS-eLearning
 */
!function(t){"use strict";class e{#t;#e;#n;#i;#r;#s;constructor(t,e,n){this.#t=t,this.#e=e,this.#n=n,this.#i=[],this.#r=[]}getName(){return this.#e.split("/").pop()}getFullName(){return this.#e}getLabel(){return this.#n}getType(){return this.#t}addChildNode(t){this.#i.push(t)}getAllChildren(){return this.#i}getChildByName(t){const e=Array.from(this.#i).filter((e=>e.getName()===t));return 0===e.length?null:e.shift()}addHtmlField(t){this.#r.push(t)}getHtmlFields(){return this.#r}getValues(){const t=[];return this.#r.forEach((e=>{"checkbox"===e.type||"radio"===e.type?e.checked&&t.push(e.value):t.push(e.value)})),t}setTransforms(t){this.#s=t}getChildren(){return this.#s&&this.#s.childrenTransform?this.#s.childrenTransform(this):this.getAllChildren()}getValuesRepresentation(){return this.#s&&this.#s.valueTransform?this.#s.valueTransform(this):this.getValues()}}const n="data-il-ui-component",i="data-il-ui-input-name",r=`fieldset[${n}][ ${i}]`,s=".c-input__field";class l{#s;#l;#a;constructor(t,n){this.#s=t,this.#l=n,this.#a=new e("form","FormContainerInput",n.getAttribute("id")),Array.from(n.querySelectorAll(r)).filter((t=>t.parentNode===t.closest("form"))).forEach((t=>this.#o(this.#a,t)))}getNodes(){return this.#a}getNodeByName(t,e){let n=e;n||(n=this.#a);return t.split("/").slice(1).forEach((t=>(n=n.getChildByName(t),n||null))),n}getValuesRepresentation(t,e,n){let i=t;i||(i=this.getNodes());let r=e;r||(r=0);let s=n;s||(s=[]);const l={label:i.getLabel(),value:i.getValuesRepresentation(),indent:r,type:i.getType()};return s.push(l),i.getChildren().forEach((t=>this.getValuesRepresentation(t,r+1,s))),s}getNodesFlat(t,e){let n=e,i=t;n||(n=[]),i||(i=this.#a),n.push(i);const r=i.getChildren();return r.length>0&&r.forEach((t=>this.getNodesFlat(t,n))),n}#o(t,e){const n=this.#c(e);t.addChildNode(n);const i=Array.from(e.querySelectorAll(`${s} ${r}`)).filter((t=>t.closest(s)===e.querySelector(s)));i.length>0&&i.forEach((t=>this.#o(n,t)))}#c(t){const s=t.getAttribute(n),l=t.getAttribute(i),a=t.querySelector(".c-input__label").textContent.trim(),o=new e(s,l,a);return o.setTransforms(this.#d(s)),Array.from(t.querySelectorAll("[name]")).filter((e=>e.closest(r)===t)).forEach((t=>o.addHtmlField(t))),o}#d(t){return this.#s[t]?this.#s[t]:null}}const a={"switchable-group-field-input":new class{valueTransform(t){const e=t.getChildren();if(0===e.length)return[];const n=[];return e.forEach((t=>n.push(t.getLabel()))),n}childrenTransform(t){return t.getAllChildren().filter((t=>t.getHtmlFields()[0].checked))}},"optional-group-field-input":new class{childrenTransform(t){return t.getHtmlFields()[0].checked?t.getAllChildren():[]}},"radio-field-input":new class{valueTransform(t){const e=t.getHtmlFields().filter((t=>t.checked));if(0===e.length)return[];const n=[];return e.forEach((t=>n.push(t.nextElementSibling.textContent))),n}},"multiSelect-field-input":new class{valueTransform(t){const e=t.getHtmlFields().filter((t=>t.checked));if(0===e.length)return[];const n=[];return e.forEach((t=>n.push(t.parentNode.textContent))),n}},"password-field-input":new class{valueTransform(t){return null}},"duration-field-input":new class{valueTransform(t){const[e,n]=t.getAllChildren().map((t=>t.getValues()[0]));return e&&n?[`${e} - ${n}`]:["-"]}childrenTransform(t){return[]}},"link-field-input":new class{valueTransform(t){const[e,n]=t.getAllChildren().map((t=>t.getValues()[0]));return[`${e} [${n}]`]}},"select-field-input":new class{valueTransform(t){const e=t.getHtmlFields()[0];return[e.options[e.options.selectedIndex].text]}}};il=il||{},il.UI=il.UI||{},il.UI.filter=function(t){t((function(){t("div.il-filter").each((function(){const n=this,r=t(n).find(".il-standard-form");let l=0,u=1;r.attr("action",window.location.pathname),t(n).find(".il-filter-field-status").each((function(){$hidden_input=this,"0"===t($hidden_input).val()?t(t("div.il-filter .il-popover-container")[l]).hide():t(t("div.il-filter .il-filter-add-list li")[l]).hide(),l++}));const p=n.querySelector(".il-filter-bar-opener").querySelector("button");p.addEventListener("click",(()=>{"false"===p.getAttribute("aria-expanded")?(p.setAttribute("aria-expanded",!0),o(n),c(r,"expand")):(p.setAttribute("aria-expanded",!1),a(n),c(r,"collapse"))}));let f=!1;t(n).find(".il-popover-container").each((function(){const n=t(this).find(":input:not(:button)"),i=n.val(),r=t(this).find(".leftaddon").text(),s=e(n,i);""!==s?(t(".il-filter-inputs-active").find(`span[id='${u}']`).html(`${r}: ${s}`),f=!0):t(".il-filter-inputs-active").find(`span[id='${u}']`).hide(),u++})),f||t(".il-filter-inputs-active").hide(),t(".input-group .btn.btn-bulky").attr("data-placement","bottom");let h=!0;t(n).find(".il-filter-add-list").find("li").each((function(){"none"!==t(this).css("display")&&"hidden"!==t(this).css("visibility")&&(h=!1)})),h&&t(".btn-bulky").parents(".il-popover-container").hide(),r.on("keydown",":input:not(:button)",(function(e){if(13===e.which){const n=d(r.attr("data-cmd-apply")),s=n.query_params;i(t(this),s),r.attr("action",n.path),r.submit(),e.preventDefault()}})),t(".il-filter-field").keydown((function(e){const n=e.which;if(13===n||32===n){t(this).click();const n=s(t(this));0!=n.length&&n[0].focus(),e.preventDefault()}}))}))}));var e=function(e,n){let i="";if(e.is(":checkbox")){const n=[];e.each((function(){t(this).prop("checked")&&n.push(t(this).parent().find("span").text())})),0!=n.length&&(active_checkboxes=n.join(", "),i=active_checkboxes)}else if(e.is("select")&&""!==n){i=e.find("option:selected").text()}else void 0!==n&&""!==n&&(i=n);return i};const n=function(e,n,i){t(e.parents(".il-filter").find(".il-filter-field-status").get(n)).val(i)};var i=function(t,e){for(const n in e){const i=`<input type="hidden" name="${n}" value="${e[n]}">`;t.parents("form").find(".il-filter-bar").before(i)}};const r=function(t){return t.parents(".il-popover-container").find(":input")};var s=function(t){return t.parents(".il-popover-container").find(".il-standard-popover-content").children().children().find("input")};const l=function(t){return t.parents(".il-standard-form").find(".btn-bulky").parents(".il-popover-container")};var a=function(t){t.querySelector("[data-collapse-glyph-visibility]").dataset.collapseGlyphVisibility="0",t.querySelector("[data-expand-glyph-visibility]").dataset.expandGlyphVisibility="1",t.querySelector(".il-filter-inputs-active").dataset.activeInputsExpanded="1",t.querySelector(".il-filter-input-section").dataset.sectionInputsExpanded="0"},o=function(t){t.querySelector("[data-expand-glyph-visibility]").dataset.expandGlyphVisibility="0",t.querySelector("[data-collapse-glyph-visibility]").dataset.collapseGlyphVisibility="1",t.querySelector(".il-filter-inputs-active").dataset.activeInputsExpanded="0",t.querySelector(".il-filter-input-section").dataset.sectionInputsExpanded="1"},c=function(e,n){const i=e.attr(`data-cmd-${n}`),r=e.serialize();t.ajax({type:"GET",url:`${i}&${r}`})};function d(t){let e;const n=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],i=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(t),r={};let s=14;for(;s--;)i[s]&&(r[n[s]]=i[s]);return r.query_params={},e=r[n[12]]||"",e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,((t,e,n)=>{e&&(r.query_params[e]=n)})),delete r.source,r}return{onInputUpdate:function(e,n){let i;const r=t(n.triggerer[0]).parents(".il-popover").attr("id");i=r?document.querySelector(`span[data-target='${r}']`):n.triggerer[0].closest(".input-group").querySelector("span.il-filter-field"),i&&(i.innerText=n.options.string_value)},onRemoveClick:function(e,i){const a=t(`#${i}`),o=a.parents(".il-popover-container").index();n(a,o,"0"),a.parents(".il-popover-container").hide();r(a).val("");const c=s(a);c.each((function(){t(this).prop("checked",!1)})),c.parents(".il-popover-container").find(".il-filter-field").html("");const d=a.parents(".input-group").find(".input-group-addon.leftaddon").html(),u=function(e,n){return e.parents(".il-standard-form").find(".btn-link").filter((function(){return t(this).text()===n})).parents("li")}(a,d);u.show();const p=l(a);0!=a.parents(".il-standard-form").find(".il-popover-container:hidden").length&&p.show()},onAddClick:function(e,i){const a=t(`#${i}`),o=a.text();a.parent().hide();const c=a.parent().index();n(a,c,"1");const d=function(e,n){return e.parents(".il-standard-form").find(".input-group-addon.leftaddon").filter((function(){return t(this).text()===n}))}(a,o);d.parents(".il-popover-container").show();r(d).focus(),d.parent().find(".il-filter-field").click();const u=s(d);0!=u.length&&u[0].focus();const p=l(a);0===a.parents(".il-filter").find(".il-filter-add-list").find("li:visible").length&&p.hide(),p.find(".il-popover").hide()},onCmd:function(e,n,r){const s=t(`#${n}`),l=d(s.parents("form").attr(`data-cmd-${r}`)),a=l.query_params;i(s,a),s.parents("form").attr("action",l.path),s.parents("form").submit()}}}(t),il.UI.Input=il.UI.Input||{},il.UI.Input.Container=new class{#u=[];#s;constructor(t){this.#s=t}init(t){const e=`#${t}`,n=document.querySelector(e);if(void 0!==this.#u[t])throw new Error(`Container with id '${t}' has already been registered.`);this.#u[t]=new l(this.#s,n)}get(t){return this.#u[t]}getAll(){return this.#u}first(){return this.#u[Object.keys(this.#u).shift()]}}(a)}($);
