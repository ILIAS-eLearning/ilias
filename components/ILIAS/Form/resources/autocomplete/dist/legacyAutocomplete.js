/**
 * This file is part of ILIAS, a powerful learning management system
 * published by ILIAS open source e-Learning e.V.
 *
 * ILIAS is licensed with the GPL-3.0,
 * see https://www.gnu.org/licenses/gpl-3.0.en.html
 * You should have received a copy of said license along with the
 * source code, too.
 *
 * If this is not the case or you just want to try ILIAS, you'll find
 * us at:
 * https://www.ilias.de
 * https://github.com/ILIAS-eLearning
 */
!function(e){"use strict";const t="more";let n;function a(e,t,n){const a=document.createElement("li");return a.tabIndex=0,a.textContent=e,a.dataset.value=t,void 0!==n&&(a.dataset.id=n),a}async function i(e,i,l){try{const{signal:d}=n,u=await fetch(e,{signal:d});if(!u.ok)throw new Error(`Response status: ${u.status}`);const s=await u.json(),m=function(e){if(void 0===e.items)return e;const t=[];return Object.entries(e.items).forEach((([e,n])=>{t[e]=n})),t}(s);if(0===m.length)return;const c=document.createElement("ul");if(c.style.left=`${i.offsetLeft}px`,c.style.minWidth=`${i.offsetWidth}px`,c.classList.add("c-form__autocomplete"),m.forEach((e=>{i.value!==e.value&&i.value.includes(e.value)||c.appendChild(a(e.label,e.value,e.id))})),s.hasMoreResults&&c.appendChild(a(l.moreText,t)),0===c.length)return;c.addEventListener("keydown",(e=>{o(e,l)})),c.addEventListener("click",(e=>{r(e,l)}));const g=document.activeElement.dataset.value;"UL"===i.nextElementSibling?.nodeName&&i.nextElementSibling.remove(),i.parentNode.appendChild(c),void 0!==g&&i.parentNode.querySelector(`[data-value="${g}"]`).focus()}catch(e){}}function o(e,t){"Enter"===e.key&&"LI"===e.target.nodeName&&(e.preventDefault(),r(e,t)),"ArrowDown"===e.key&&(e.stopImmediatePropagation(),e.preventDefault(),"UL"===e.target.nextElementSibling?.nodeName&&e.target.nextElementSibling.firstElementChild.focus(),"LI"===e.target.nodeName&&null!==e.target.nextElementSibling&&e.target.nextElementSibling.focus()),"ArrowUp"===e.key&&"LI"===e.target.nodeName&&(e.stopImmediatePropagation(),e.preventDefault(),null===e.target.previousElementSibling?e.target.parentElement.previousElementSibling.focus():e.target.previousElementSibling.focus())}function r(e,a){n.abort();let{value:o}=e.target.dataset;if(o!==t){if(null!==a.delimiter){const t=e.target.parentNode.previousElementSibling.value.split(a.delimiter);let n="";t.length>1&&(n=t.slice(0,-1).join(",")+a.delimiter),o=n+o+a.delimiter}e.target.parentNode.previousElementSibling.value=o,e.target.parentNode.previousElementSibling.focus(),e.target.parentNode.remove(),n=new AbortController,a.submitOnSelection&&"id"in e.target.dataset&&(window.location.href=`${a.submitUrl}&selected_id=${encodeURIComponent(e.target.dataset.id)}`)}else i(`${a.dataSource}&fetchall=1`,e.target.parentNode.previousElementSibling,a)}function l(e,t){n=new AbortController,e.addEventListener("keydown",(e=>{o(e,t)})),e.addEventListener("keyup",(e=>{!function(e,t){if(void 0===e.key||"Tab"===e.key||"ArrowDown"===e.key||"ArrowUp"===e.key)return;if(e.target.value.length<t.autocompleteLength)return void e.target.nextElementSibling?.remove();let n=e.target.value.trim();null!==t.delimiter&&(n=n.split(t.delimiter).at(-1).trim()),i(`${t.dataSource}&term=${encodeURIComponent(n)}`,e.target,t)}(e,t)}))}e.LegacyForm=e.LegacyForm||{},e.LegacyForm.autocomplete=e.LegacyForm.autocomplete||{},e.LegacyForm.autocomplete.init=(e,t)=>l(e,t)}(il);
